<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>Lokale AI OCR (Transformer)</title>
    <script type="module">
        // We importeren de AI-bibliotheek direct
        import { pipeline } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.1';

        let recognizer;
        const status = document.getElementById('status');
        const segmentsContainer = document.getElementById('segments');

        // Initialiseer het AI-model
        async function initAI() {
            status.innerText = "AI-model laden... (dit gebeurt alleen de eerste keer)";
            try {
                // We gebruiken het TrOCR-model (Printed) - zeer accuraat voor documenten
                recognizer = await pipeline('image-to-text', 'Xenova/trocr-small-printed');
                status.innerText = "AI is klaar voor gebruik. Upload een foto.";
            } catch (e) {
                status.innerText = "Fout bij laden AI: " + e.message;
            }
        }

        async function processImage(file) {
            if (!recognizer) return;
            
            status.innerText = "AI analyseert de afbeelding... (dit gebruikt je processor/GPU)";
            segmentsContainer.innerHTML = "";

            const url = URL.createObjectURL(file);
            
            // De AI voert de herkenning uit
            // TrOCR werkt het best op regels, we kunnen de hele afbeelding sturen
            const output = await recognizer(url);
            
            status.innerText = "Analyse voltooid.";
            displayResult(output[0].generated_text);
        }

        function displayResult(text) {
            // De AI geeft vaak een zeer schone zin terug. 
            // We splitsen deze voor het gemak op in logische brokken.
            const blocks = text.split(/(?=[A-Z][a-z]+:)/); // Splitst op woorden die eindigen met een dubbele punt (labels)

            blocks.forEach(block => {
                if(block.trim().length < 2) return;
                const div = document.createElement('div');
                div.className = 'segment';
                div.onclick = () => {
                    navigator.clipboard.writeText(block.trim());
                    alert("Gekopieerd: " + block.trim());
                };
                div.innerHTML = `<span>${block.trim()}</span> <small>AI GECONTROLEERD</small>`;
                segmentsContainer.appendChild(div);
            });
        }

        document.getElementById('fileInput').onchange = (e) => processImage(e.target.files[0]);
        initAI();
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; background: #fdfdfd; padding: 40px; }
        .container { max-width: 600px; margin: 0 auto; background: white; border: 1px solid #e1e4e8; padding: 20px; border-radius: 12px; }
        .segment { padding: 15px; border: 1px solid #eee; margin: 10px 0; border-radius: 8px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; background: #fafafa; transition: 0.2s; }
        .segment:hover { border-color: #007bff; background: #f0f7ff; }
        #status { color: #666; font-size: 0.9em; margin-bottom: 20px; text-align: center; }
        .segment small { color: #28a745; font-weight: bold; font-size: 0.7em; }
    </style>
</head>
<body>
    <div class="container">
        <h2>Lokale AI Document Scanner</h2>
        <div id="status">AI initialiseren...</div>
        <input type="file" id="fileInput" accept="image/*" style="width: 100%; padding: 20px; border: 2px dashed #ccc;">
        <div id="segments"></div>
    </div>
</body>
</html>
