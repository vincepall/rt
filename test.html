<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P.R.U.T.S</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <a href="index.html" class="home-icon"><i class="fas fa-home"></i></a>
    <style>
        /* Add some styling to make the layout look good */
        .form-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 10px auto;
            max-width: 600px;
        }
        .form-item {
            display: flex;
            flex-direction: row;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }
        .form-item label {
            min-width: 200px;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-item input,
        .form-item select {
            flex: 1;
            padding: 8px;
            width: 100%;
            min-width: 200px;
            box-sizing: border-box;
        }
        .submit-btn {
            background-color: #F5DF4D;
            color: black;
            padding: 15px 30px;
            font-size: 18px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            display: block;
            margin: 20px auto;
            width: 100%;
            max-width: 400px;
        }
        .image-container {
            position: relative;
            background-size: cover;
            border: 1px solid black;
            margin: 20px auto;
            z-index: 2;
        }
        .crosshair {
            position: absolute;
            width: 30px;
            height: 30px;
            left: 0;
            top: 0;
            pointer-events: none;
        }

        .crosshair::before,
        .crosshair::after {
            content: '';
            position: absolute;
            background-color: rgb(255, 49, 49);
        }

        .crosshair::before { top: 14px; left: 0; width: 30px; height: 2px; }
        .crosshair::after { left: 14px; top: 0; width: 2px; height: 30px; }

        .highlight-circle {
            position: absolute;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: rgba(0, 0, 128, 0.2);
            left: -10px;
            top: -10px;
            pointer-events: none;
        }
        #wire-result {
            color: yellow;
        }
        #container1A h2,
        #container2A h2,
        #container1B h2,
        #container2B h2 {
            color: red;
        }
        #results-section {
            scroll-margin-top: 20px;
        }
        .ffd-warning {
            color: red;
            font-weight: bold;
            margin: 10px 0;
            padding: 10px;
            background-color: rgba(255, 0, 0, 0.1);
            border-radius: 5px;
            display: none;
        }
        .diameter-warning {
            color: orange;
            font-weight: bold;
            margin: 10px 0;
            padding: 10px;
            background-color: rgba(255, 165, 0, 0.1);
            border-radius: 5px;
            display: none;
        }
        .red-text {
            color: red;
        }
        .form-item input[type="checkbox"] {
            flex: 0;
            width: 20px;
            height: 20px;
            min-width: 20px;
        }
        h1 {
            background-color: white;
            font-size: 30px;
            color: black;
            padding: 10px;
            border-radius: 30px;
            text-align: center;
            max-width: 500px;
            margin: 20px auto;
            border-style: solid;
            border-color: black;
            text-shadow: none;
        }
        #pruts-image {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 150px;
            z-index: 1;
        }
    </style>
</head>
<body>
    <img src="pruts.png" id="pruts-image" alt="P.R.U.T.S. Mascot">
    <h1>Hallo, Ik ben P.R.U.T.S <br> (Pijplas Radiografie Ultieme Technische Sidekick)</h1>

    <div class="form-container">
        <div class="form-item">
            <label for="procedure">Kies de procedure:</label>
            <select id="procedure" name="procedure" required>
                <option value="" disabled selected>Selecteer procedure</option>
                <option value="EN-A">EN-Klasse A</option>
                <option value="EN-B">EN-Klasse B</option>
                <option value="ASME">ASME</option>
            </select>
        </div>
        <div class="form-item" id="klantprocedureDiv">
            <label for="klantprocedureCheckbox">Klantprocedure:</label>
            <input type="checkbox" id="klantprocedureCheckbox">
        </div>
        <div class="form-item" id="enBSubProcedureDiv" style="display:none;">
            <label for="enBSubProcedure">Klantprocedure:</label>
            <select id="enBSubProcedure" name="enBSubProcedure">
                <option value="" disabled selected>Selecteer procedure</option>
                <option value="RT16172">RT16172 Sabic</option>
                <option value="RT14171">RT14171 Sitech</option>
                <option value="RT20230059">RT 2023 0059 Haffmans</option>
            </select>
        </div>
        <div class="form-item">
            <label for="diameter">Diameter (De) in mm:</label>
            <input type="number" id="diameter" name="diameter" step="0.01" required>
        </div>
        <div class="form-item">
            <label for="wanddikte">Wanddikte (t) in mm:</label>
            <input type="number" id="wanddikte" name="wanddikte" step="0.01" required>
        </div>
        <div class="form-item">
            <label for="technique">Opstelling:</label>
            <select id="technique" name="technique">
                <option value="SWSI">SWSI</option>
                <option value="DWSI">DWSI</option>
                <option value="DWDI">DWDI</option>
            </select>
        </div>
         <div class="form-item" id="optieDiv" style="display:none;">
            <label for="optie">Centraal of Excentrisch:</label>
            <select id="optie" name="optie">
                <option value="">Nee</option>
                <option value="1">Centraal</option>
                <option value="2">Excentrisch</option>
            </select>
        </div>
        <div id="enOptions" style="display:none;">
            <div class="form-item">
                <label for="source">Stralingsbron:</label>
                <select id="source" name="source">
                    <option value="X-ray">X-ray</option>
                    <option value="Se75">Se-75</option>
                    <option value="Ir192">Ir-192</option>
                </select>
            </div>
            <div class="form-item" id="ovenMateriaalDiv" style="display:none;">
                <label for="ovenMateriaal">Ovenmateriaal:</label>
                <select id="ovenMateriaal" name="ovenMateriaal">
                    <option value="Nee">Nee</option>
                    <option value="Ja">Ja</option>
                </select>
            </div>
            <div class="form-item" id="ovaaltjeDiv" style="display:none;">
                <label for="ovaaltje">Ovaaltje:</label>
                <select id="ovaaltje" name="ovaaltje">
                    <option value="Nee">Nee</option>
                    <option value="Ja">Ja</option>
                </select>
            </div>
            <div class="form-item" id="lasbreedteDiv" style="display:none;">
                <label for="lasbreedte">Lasbreedte (mm):</label>
                <input type="number" id="lasbreedte" name="lasbreedte" step="0.01">
            </div>
        </div>
        <div class="form-item">
            <label for="brongrootte">Brongrootte in mm:</label>
            <input type="text" id="brongrootte" name="brongrootte" list="bronKeuzes" required placeholder="Kies of vul in (mm)">
            <datalist id="bronKeuzes">
            </datalist>
        </div>
        <div class="form-item">
            <label for="ofa">Object Film Afstand (OFA) in mm:</label>
            <input type="number" id="ofa" name="ofa" step="0.01" required>
            <span id="ofa-warning" style="color: red; margin-left: 10px;"></span>
        </div>
        <div class="form-item">
            <label for="sfd">Bron Film Afstand (FFD) in mm:</label>
            <input type="number" id="sfd" name="sfd" step="0.01" required>
            <span id="ffd-warning" style="color: red; margin-left: 10px;"></span>
        </div>
        <div id="asmeOptions" style="display:none;">
            <div class="form-item">
                <label for="asmeTechnique">Plaats van de BKI:</label>
                <select id="asmeTechnique" name="asmeTechnique">
                    <option value="Sourceside">BKI bronzijde</option>
                    <option value="Filmside">BKI Filmzijde</option>
                </select>
            </div>
            <div class="form-item">
                <label for="weldType">Lastype:</label>
                <select id="weldType" name="weldType">
                    <option value="A">A</option>
                    <option value="B">B</option>
                    <option value="C">C</option>
                    <option value="D">D</option>
                </select>
            </div>
        </div>

        <button type="button" class="submit-btn" onclick="calculate()">Controleer</button>
    </div>

    <div id="results-section">
        <h2>Resultaten</h2>
        <p id="summary-result" style="color: yellow; background-color: #333; padding: 5px; border-radius: 5px; display: inline-block; width: fit-content; margin: 0 auto;"></p>
        <div id="source-warning" class="diameter-warning"></div>
        <div class="diameter-warning" id="diameter-warning"></div>
        <div class="ffd-warning" id="ffd-result-warning"></div>
        <p id="wire-result"></p>
        <p id="min-ffd-result" style="color: yellow;"></p>
        <p id="film-quality-result" style="color: yellow;"></p>
        <p id="exposure-result" style="color: yellow;"></p>
        <p id="verzet-result" style="color: yellow;"></p>
        <p id="max-kv-result" style="color: yellow;"></p>
        <p id="activity-result" style="color: yellow;"></p>

        <div id="diameterAntwoord" style="display: none; text-align: center; margin: 20px;">
            <strong style="font-size: 1.3em; color: yellow; padding: 15px;">
                Aantal opnames: 2 bij opstelling 11/F , 3 bij opstelling 12/G
            </strong>
        </div>

        <div class="image-container" id="container1B" style="display: none; width: 488px; height: 819px; background-image: url('klasseb2.png');">
          <h2>Opstelling 5/8/13/14 (Klasse B)</h2>
        </div>
        <div class="image-container" id="container2B" style="display: none; width: 488px; height: 823px; background-image: url('klasseb1.png');">
          <h2>Opstelling 2 (Klasse B)</h2>
        </div>
        <div class="image-container" id="container1A" style="display: none; width: 487px; height: 823px; background-image: url('opstelling13klassea.png');">
          <h2>Opstelling 5/8/13/14 (Klasse A)</h2>
        </div>
        <div class="image-container" id="container2A" style="display: none; width: 470px; height: 796px; background-image: url('opstelling2klassea.png');">
          <h2>Opstelling 2 (Klasse A)</h2>
        </div>
    </div>

    <script>
        // --- UTILITY AND SETUP FUNCTIONS ---
        function getFloatValue(id) {
            const element = document.getElementById(id);
            if (element && element.value) {
                return parseFloat(element.value.replace(',', '.'));
            }
            return NaN;
        }

        let bronnenData = [];
        let minFFD = 0;
        let ofaManuallyEdited = false;

        document.getElementById('ofa').addEventListener('input', () => {
            ofaManuallyEdited = true;
        });

        const coreParams = ['procedure', 'diameter', 'wanddikte', 'technique'];
        coreParams.forEach(id => {
            document.getElementById(id).addEventListener('change', () => { ofaManuallyEdited = false; });
        });

        // --- EVENT LISTENERS ---
        const fieldsThatTriggerAutoFill = [
            "procedure", "diameter", "wanddikte", "brongrootte", "technique",
            "source", "optie", "asmeTechnique", "weldType", "ovaaltje", "lasbreedte"
        ];
        const fieldsThatTriggerCalcOnly = ["ofa", "sfd"];

        const calculateAndFill = () => autoCalculate(true);
        const calculateWithoutFill = () => autoCalculate(false);

        fieldsThatTriggerAutoFill.forEach(id => {
            const element = document.getElementById(id);
            if (element) {
                element.addEventListener("input", calculateAndFill);
                element.addEventListener("change", calculateAndFill);
            }
        });

        fieldsThatTriggerCalcOnly.forEach(id => {
            const element = document.getElementById(id);
            if (element) {
                const eventHandler = () => {
                    if (id === 'ofa') checkOFAWarning();
                    calculateWithoutFill();
                };
                element.addEventListener("input", eventHandler);
                element.addEventListener("change", eventHandler);
            }
        });

        document.getElementById("sfd").addEventListener("input", function() {
            checkFFDWarning();
            calculateWithoutFill();
        });

        document.getElementById("enBSubProcedure").addEventListener("change", function() {
            const enBSubProcedure = this.value;
            const ovenMateriaalDiv = document.getElementById("ovenMateriaalDiv");
            ovenMateriaalDiv.style.display = (enBSubProcedure === "RT16172") ? "flex" : "none";
            calculateAndFill();
        });

        document.getElementById("ovaaltje").addEventListener("change", function() {
            const ovaaltje = this.value;
            const lasbreedteDiv = document.getElementById("lasbreedteDiv");
            lasbreedteDiv.style.display = (ovaaltje === "Ja") ? "flex" : "none";
            calculateAndFill();
        });

        // --- UI AND FORM LOGIC FUNCTIONS ---
        function updateBronGrootteOptions() {
            const procedure = document.getElementById("procedure").value;
            const source = document.getElementById("source").value;
            const bronKeuzesDatalist = document.getElementById("bronKeuzes");
            bronKeuzesDatalist.innerHTML = '';

            const xrayOptions = `
                <option value="Yxlon (3 mm)"></option>
                <option value="Yxlon Smart (1 mm)"></option>
                <option value="Balteau (2.5 mm)"></option>
            `;

            if (procedure === "ASME") {
                bronnenData.forEach(bron => {
                    const option = document.createElement('option');
                    option.value = bron.label;
                    bronKeuzesDatalist.appendChild(option);
                });
                bronKeuzesDatalist.innerHTML += xrayOptions;
            } else if (source === 'X-ray') {
                bronKeuzesDatalist.innerHTML = xrayOptions;
            } else {
                const filteredBronnen = bronnenData.filter(b => b.type === source);
                filteredBronnen.forEach(bron => {
                    const option = document.createElement('option');
                    option.value = bron.label;
                    bronKeuzesDatalist.appendChild(option);
                });
            }
        }

        function handleDiameterTechniqueRestriction() {
            const diameter = getFloatValue("diameter");
            const techniqueSelect = document.getElementById("technique");
            const swsiOption = techniqueSelect.querySelector('option[value="SWSI"]');
            const dwsiOption = techniqueSelect.querySelector('option[value="DWSI"]');
            const dwdiOption = techniqueSelect.querySelector('option[value="DWDI"]');
            if (!techniqueSelect || !swsiOption || !dwsiOption || !dwdiOption) return;

            const isSmallDiameter = !isNaN(diameter) && diameter < 100;
            const isLargeDiameter = !isNaN(diameter) && diameter >= 100;

            dwdiOption.disabled = isLargeDiameter;
            swsiOption.disabled = isSmallDiameter;
            dwsiOption.disabled = isSmallDiameter;

            if (isSmallDiameter && techniqueSelect.value !== "DWDI") {
                techniqueSelect.value = "DWDI";
            } else if (isLargeDiameter && techniqueSelect.value === "DWDI") {
                techniqueSelect.value = "SWSI";
            }
        }

        function handleCentraalAutoFill() {
            const procedure = document.getElementById("procedure").value;
            const optie = document.getElementById("optie").value;
            const diameter = getFloatValue("diameter");
            const wanddikte = getFloatValue("wanddikte");
            const sfdInput = document.getElementById("sfd");
            const ofaInput = document.getElementById("ofa");

            if ((procedure === "EN-A" || procedure === "EN-B") && optie === '1') {
                if (!isNaN(diameter)) sfdInput.value = (diameter / 2).toFixed(2);
                if (!isNaN(wanddikte)) ofaInput.value = wanddikte.toFixed(2);
            }
        }

        function updateVisibility() {
            const technique = document.getElementById("technique").value;
            document.getElementById("optieDiv").style.display = (technique === "SWSI") ? "flex" : "none";
            const ovaaltjeDiv = document.getElementById("ovaaltjeDiv");
            ovaaltjeDiv.style.display = (technique === "DWDI") ? "flex" : "none";

            if (ovaaltjeDiv.style.display === "none" && document.getElementById("ovaaltje").value === "Ja") {
                document.getElementById("ovaaltje").value = "Nee";
                document.getElementById("lasbreedteDiv").style.display = "none";
            }
        }

        function checkOFAWarning() {
            const procedure = document.getElementById("procedure").value;
            const diameter = getFloatValue("diameter");
            const wanddikte = getFloatValue("wanddikte");
            const technique = document.getElementById("technique").value;
            const userOFA = getFloatValue("ofa");
            const warningSpan = document.getElementById("ofa-warning");
            warningSpan.innerText = "";

            if (isNaN(userOFA)) return;

            let autoOFA = NaN;
            if (procedure === "ASME") {
                autoOFA = (diameter < 100) ? diameter : wanddikte;
            } else if ((procedure === "EN-A" || procedure === "EN-B") && technique === "DWDI" && diameter < 100) {
                autoOFA = diameter;
            } else if (technique === "SWSI" || technique === "DWSI") {
                autoOFA = wanddikte;
            } else if (technique === "DWDI") {
                autoOFA = diameter;
            }

            if (!isNaN(autoOFA) && userOFA < autoOFA) {
                warningSpan.innerText = `Waarschuwing: OFA is lager dan aanbevolen minimum van ${autoOFA.toFixed(2)} mm`;
            }
        }

        // --- CORE CALCULATION FUNCTIONS ---

        function autoCalculate(shouldAutoFill = true) {
            if (shouldAutoFill) {
                handleCentraalAutoFill();
                updateOFA();
            }
            checkOFAWarning();
            handleDiameterTechniqueRestriction();
            updateVisibility();
            updateFFD();
            calculateResults();
        }

        function updateOFA() {
            if (ofaManuallyEdited) return;

            const procedure = document.getElementById("procedure").value;
            const diameter = getFloatValue("diameter");
            const wanddikte = getFloatValue("wanddikte");
            const ofaInput = document.getElementById("ofa");
            const technique = document.getElementById("technique").value;
            const optie = document.getElementById("optie").value;

            if (optie === '1' && (procedure === "EN-A" || procedure === "EN-B")) return;
            if (isNaN(wanddikte)) return;

            let autoOFA = NaN;
            if (procedure === "ASME") {
                if (isNaN(diameter)) return;
                autoOFA = (diameter < 100) ? diameter : wanddikte;
            } else if ((procedure === "EN-A" || procedure === "EN-B") && technique === "DWDI" && !isNaN(diameter) && diameter < 100) {
                autoOFA = diameter;
            } else if (technique === "SWSI" || technique === "DWSI") {
                autoOFA = wanddikte;
            } else if (technique === "DWDI") {
                if (isNaN(diameter)) return;
                autoOFA = diameter;
            }

            if (!isNaN(autoOFA)) ofaInput.value = autoOFA.toFixed(2);
        }

        function updateFFD() {
            calculateMinFFD();
            checkFFDWarning();
        }

        function calculateMinFFD() {
            const procedure = document.getElementById("procedure").value;
            const diameter = getFloatValue("diameter");
            const wanddikte = getFloatValue("wanddikte");
            const brongrootteValue = document.getElementById("brongrootte").value;
            const ofa = getFloatValue("ofa");
            const optie = document.getElementById("optie").value;

            let brongrootte = 0;
            if (brongrootteValue.includes("Yxlon (3 mm)")) brongrootte = 3;
            else if (brongrootteValue.includes("Yxlon Smart (1 mm)")) brongrootte = 1;
            else if (brongrootteValue.includes("Balteau (2.5 mm)")) brongrootte = 2.5;
            else {
                const bron = bronnenData.find(b => b.label === brongrootteValue);
                brongrootte = bron ? bron.size : getFloatValue("brongrootte");
            }

            if (isNaN(diameter) || isNaN(wanddikte) || isNaN(brongrootte) || isNaN(ofa)) {
                minFFD = 0;
                return;
            }

            let ffd = 0;
            if (procedure === "ASME") {
                if (wanddikte < 50) ffd = (brongrootte * ofa) / 0.51 + ofa;
                else if (wanddikte < 75) ffd = (brongrootte * ofa) / 0.76 + ofa;
                else if (wanddikte <= 100) ffd = (brongrootte * ofa) / 1.02 + ofa;
                else {
                    minFFD = 0;
                    return;
                }
            } else { // EN-A or EN-B
                let factor = (procedure === "EN-A") ? 7.5 : 15;
                let basis = brongrootte * factor * Math.pow(ofa, 2 / 3);
                if (optie === '1') basis *= 0.5; // Centraal
                if (optie === '2') basis *= 0.8; // Excentrisch
                ffd = basis + ofa;
            }
            minFFD = ffd;
        }

        function checkFFDWarning() {
            const userFFD = getFloatValue("sfd");
            const warningSpan = document.getElementById("ffd-warning");
            warningSpan.innerText = "";
            if (isNaN(minFFD) || minFFD === 0) return;
            if (!isNaN(userFFD) && userFFD < minFFD) {
                warningSpan.innerText = `Waarschuwing: FFD is lager dan minimum van ${minFFD.toFixed(2)} mm`;
            }
        }
        
        // *** FINAL HIGH-PRECISION QUADRATIC MODEL FUNCTION ***
        function getNumberOfExposures(graphType, x, y) {
            // Check for the impossible zone first. The dashed line is mathematically y=x.
            if (y <= x) {
                return '<span class="red-text">Onmogelijk (bron in/voorbij de wand)</span>';
            }

            // High-precision quadratic models (y = ax^2 + bx + c)
            const models = {
                graph1: { // Opstelling 5/8/13/14
                    line_3: { a: -1.74, b: 1.99, c: 1.05 },
                    line_4: { a: -1.48, b: 1.74, c: 0.73 },
                    line_6: { a: -0.64, b: 1.40, c: 0.38 },
                    line_7: { a: -0.42, b: 1.25, c: 0.26 },
                    line_8: { a: 0.84,  b: 0.91, c: 0.17 },
                    line_9: { a: 1.09,  b: 0.85, c: 0.08 },
                    line_10:{ a: 0.0,   b: 1.39, c: 0.04 },
                    line_11:{ a: 1.63,  b: 0.45, c: -0.01 }
                },
                graph2: { // Opstelling 2
                    line_3: { a: -3.48, b: 3.98, c: 2.1 },
                    line_4: { a: -2.96, b: 3.48, c: 1.46 },
                    line_6: { a: -1.28, b: 2.80, c: 0.76 },
                    line_7: { a: -0.84, b: 2.50, c: 0.52 },
                    line_8: { a: 1.68,  b: 1.82, c: 0.34 },
                    line_9: { a: 2.18,  b: 1.70, c: 0.16 },
                    line_10:{ a: 0.0,   b: 2.78, c: 0.08 },
                    line_11:{ a: 3.26,  b: 0.90, c: -0.02}
                }
            };

            const m = models[graphType];
            if (!m) return "N/A";
            
            const calcBoundary = (line, x_val) => (line.a * x_val * x_val) + (line.b * x_val) + line.c;

            if (y > calcBoundary(m.line_3, x)) return "2";
            if (y > calcBoundary(m.line_4, x)) return "3";
            // The impossible zone (dashed line area is y<=x) implies that if we are here, y must be > x.
            // The region between line_4 and line_6 is the "5" region.
            if (y > calcBoundary(m.line_6, x)) return "5"; 
            if (y > calcBoundary(m.line_7, x)) return "6";
            if (y > calcBoundary(m.line_8, x)) return "7";
            if (y > calcBoundary(m.line_9, x)) return "8";
            if (y > calcBoundary(m.line_10, x)) return "9";
            if (y > calcBoundary(m.line_11, x)) return "10";
            if (y <= calcBoundary(m.line_11, x) && y > 0) return "11+";

            return "4"; // If it's not impossible, and not in any other region, it must be in 4.
        }

        // --- MAIN CALCULATION AND DISPLAY ---
        function calculate() {
            autoCalculate(true);
            document.getElementById('results-section').scrollIntoView({ behavior: 'smooth' });
        }

        function calculateResults() {
            const procedure = document.getElementById("procedure").value;
            const diameter = getFloatValue("diameter");
            const wanddikte = getFloatValue("wanddikte");
            const ofa = getFloatValue("ofa");
            let sfd = getFloatValue("sfd");
            const source = document.getElementById("source").value;
            const technique = document.getElementById("technique").value;
            const optie = document.getElementById("optie").value;
            const centraal = optie === '1';
            const excentrisch = optie === '2';
            const ovaaltje = document.getElementById("ovaaltje").value;
            const lasbreedte = getFloatValue("lasbreedte");
            const klantprocedureCheckbox = document.getElementById("klantprocedureCheckbox").checked;
            const enBSubProcedure = document.getElementById("enBSubProcedure").value;

            let procedureText = procedure;
            if (klantprocedureCheckbox && enBSubProcedure) {
                const subProcedureSelect = document.getElementById("enBSubProcedure");
                procedureText = subProcedureSelect.options[subProcedureSelect.selectedIndex].text;
            }
            
            let summary = "";
            if (!isNaN(diameter) && !isNaN(wanddikte)) {
                summary = `${diameter}mm x ${wanddikte}mm volgens ${procedureText} met ${source}`;
            }
            document.getElementById("summary-result").innerText = summary;

            const sourceWarningDiv = document.getElementById("source-warning");
            sourceWarningDiv.style.display = 'none';
            sourceWarningDiv.innerHTML = '';
            
            if (!klantprocedureCheckbox && (procedure === "EN-A" || procedure === "EN-B")) {
                let doorstraaldeDikte = (technique === "SWSI") ? wanddikte : 2 * wanddikte;
                if (!isNaN(doorstraaldeDikte)) {
                    let warningMsg = "";
                    if (source === 'Se75' && (doorstraaldeDikte < 14 || doorstraaldeDikte > 40)) {
                        warningMsg = `Waarschuwing: Het gebruik van Se-75 voor een doorstraalde dikte van <strong>${doorstraaldeDikte.toFixed(2)} mm</strong> is ongebruikelijk (standaardbereik: 14-40 mm). Een lagere dikte is in overleg met de opdrachtgever wel mogelijk.`;
                    } else if (source === 'Ir192') {
                        if (doorstraaldeDikte < 10) {
                            warningMsg = `Waarschuwing: Het gebruik van Ir192 is niet toegestaan voor een doorstraalde dikte van <strong>${doorstraaldeDikte.toFixed(2)} mm</strong>.`;
                        } else if (doorstraaldeDikte < 20 || doorstraaldeDikte > 90) {
                            warningMsg = `Waarschuwing: Het gebruik van Ir-192 voor een doorstraalde dikte van <strong>${doorstraaldeDikte.toFixed(2)} mm</strong> is ongebruikelijk (standaardbereik: 20-90 mm, met uitzondering tot 10 mm). Gebruik is in overleg met de opdrachtgever wel mogelijk.`;
                        }
                    }
                    if (warningMsg) {
                        sourceWarningDiv.innerHTML = warningMsg;
                        sourceWarningDiv.style.display = 'block';
                    }
                }
            }

            const diameterWarningDiv = document.getElementById("diameter-warning");
            if (!isNaN(diameter) && diameter < 100 && (procedure === "EN-A" || procedure === "EN-B")) {
                if (technique !== "DWDI") {
                    diameterWarningDiv.textContent = "Waarschuwing: Bij een diameter kleiner dan 100 mm wordt aanbevolen om de DWDI opstelling te gebruiken.";
                    diameterWarningDiv.style.display = 'block';
                } else {
                    diameterWarningDiv.style.display = 'none';
                }
            } else {
                diameterWarningDiv.style.display = 'none';
            }

            const warningDiv = document.getElementById("ffd-result-warning");
            if (!isNaN(sfd) && !isNaN(minFFD) && minFFD > 0 && sfd < minFFD) {
                warningDiv.textContent = `Je gekozen FFD is lager dan de minimale FFD: ${minFFD.toFixed(2)} mm`;
                warningDiv.style.display = 'block';
            } else {
                warningDiv.style.display = 'none';
            }

            let wire = "Onbekend";
            if (procedure === "EN-A") {
                let penetratedThickness = 0;
                if (technique === "SWSI") {
                    penetratedThickness = wanddikte;
                    if (penetratedThickness <= 1.2) wire = "W18";
                    else if (penetratedThickness <= 2.0) wire = "W17";
                    else if (penetratedThickness <= 3.5) wire = "W16";
                    else if (penetratedThickness <= 5) wire = "W15";
                    else if (penetratedThickness <= 7) wire = "W14";
                    else if (penetratedThickness <= 10) wire = "W13";
                    else if (penetratedThickness <= 15) wire = "W12";
                    else if (penetratedThickness <= 25) wire = "W11";
                    else if (penetratedThickness <= 32) wire = "W10";
                    else if (penetratedThickness <= 40) wire = "W9";
                    else if (penetratedThickness <= 55) wire = "W8";
                    else if (penetratedThickness <= 85) wire = "W7";
                } else if (technique === "DWSI") {
                    penetratedThickness = wanddikte * 2;
                    if (penetratedThickness <= 1.2) wire = "W18";
                    else if (penetratedThickness <= 2.0) wire = "W17";
                    else if (penetratedThickness <= 3.5) wire = "W16";
                    else if (penetratedThickness <= 5) wire = "W15";
                    else if (penetratedThickness <= 10) wire = "W14";
                    else if (penetratedThickness <= 15) wire = "W13";
                    else if (penetratedThickness <= 22) wire = "W12";
                    else if (penetratedThickness <= 38) wire = "W11";
                    else if (penetratedThickness <= 48) wire = "W10";
                    else if (penetratedThickness <= 60) wire = "W9";
                    else if (penetratedThickness <= 85) wire = "W8";
                } else if (technique === "DWDI") {
                    penetratedThickness = wanddikte * 2;
                    if (penetratedThickness <= 1.2) wire = "W18";
                    else if (penetratedThickness <= 2.0) wire = "W17";
                    else if (penetratedThickness <= 3.5) wire = "W16";
                    else if (penetratedThickness <= 5) wire = "W15";
                    else if (penetratedThickness <= 7) wire = "W14";
                    else if (penetratedThickness <= 12) wire = "W13";
                    else if (penetratedThickness <= 18) wire = "W12";
                    else if (penetratedThickness <= 30) wire = "W11";
                    else if (penetratedThickness <= 40) wire = "W10";
                    else if (penetratedThickness <= 50) wire = "W9";
                    else if (penetratedThickness <= 60) wire = "W8";
                    else if (penetratedThickness <= 85) wire = "W7";
                }

                if (source === "Se75") {
                    if (technique === "DWDI" && penetratedThickness <= 12) {
                        wire = "W" + (parseInt(wire.substring(1)) - 1);
                    } else if ((technique === "SWSI" || technique === "DWSI") && penetratedThickness <= 20) {
                        wire = "W" + (parseInt(wire.substring(1)) - 1);
                    }
                } else if (source === "Ir192") {
                    if (technique === "DWDI" && penetratedThickness > 10 && penetratedThickness <= 25) {
                        wire = "W" + (parseInt(wire.substring(1)) - 1);
                    } else if ((technique === "SWSI" || technique === "DWSI") && penetratedThickness > 10 && penetratedThickness <= 40) {
                        wire = "W" + (parseInt(wire.substring(1)) - 1);
                    }
                }
            } else if (procedure === "EN-B") {
                let doorstraaldeDikte = (technique === "SWSI") ? wanddikte : 2 * wanddikte;

                if (technique === "SWSI") {
                    if (doorstraaldeDikte <= 1.5) wire = "W19";
                    else if (doorstraaldeDikte <= 2.5) wire = "W18";
                    else if (doorstraaldeDikte <= 4) wire = "W17";
                    else if (doorstraaldeDikte <= 6) wire = "W16";
                    else if (doorstraaldeDikte <= 8) wire = "W15";
                    else if (doorstraaldeDikte <= 12) wire = "W14";
                    else if (doorstraaldeDikte <= 20) wire = "W13";
                    else if (doorstraaldeDikte <= 30) wire = "W12";
                    else if (doorstraaldeDikte <= 35) wire = "W11";
                    else if (doorstraaldeDikte <= 45) wire = "W10";
                    else if (doorstraaldeDikte <= 65) wire = "W9";
                } else if (technique === "DWDI") {
                    if (doorstraaldeDikte <= 1.5) wire = "W19";
                    else if (doorstraaldeDikte <= 2.5) wire = "W18";
                    else if (doorstraaldeDikte <= 4) wire = "W17";
                    else if (doorstraaldeDikte <= 6) wire = "W16";
                    else if (doorstraaldeDikte <= 8) wire = "W15";
                    else if (doorstraaldeDikte <= 15) wire = "W14";
                    else if (doorstraaldeDikte <= 25) wire = "W13";
                    else if (doorstraaldeDikte <= 38) wire = "W12";
                    else if (doorstraaldeDikte <= 45) wire = "W11";
                    else if (doorstraaldeDikte <= 55) wire = "W10";
                    else if (doorstraaldeDikte <= 70) wire = "W9";
                } else if (technique === "DWSI") {
                    if (doorstraaldeDikte <= 1.5) wire = "W19";
                    else if (doorstraaldeDikte <= 2.5) wire = "W18";
                    else if (doorstraaldeDikte <= 4) wire = "W17";
                    else if (doorstraaldeDikte <= 6) wire = "W16";
                    else if (doorstraaldeDikte <= 12) wire = "W15";
                    else if (doorstraaldeDikte <= 18) wire = "W14";
                    else if (doorstraaldeDikte <= 30) wire = "W13";
                    else if (doorstraaldeDikte <= 45) wire = "W12";
                    else if (doorstraaldeDikte <= 55) wire = "W11";
                    else if (doorstraaldeDikte <= 70) wire = "W10";
                }

                if (source === "Se75") {
                    if (technique === "SWSI"  && doorstraaldeDikte > 5 && doorstraaldeDikte <= 20) wire = "W" + (parseInt(wire.substring(1)) - 1);
                    else if (technique === "DWDI" && doorstraaldeDikte > 5 &&  doorstraaldeDikte <= 12) wire = "W" + (parseInt(wire.substring(1)) - 1);
                    else if (technique === "DWSI" && doorstraaldeDikte > 5 && doorstraaldeDikte <= 20) wire = "W" + (parseInt(wire.substring(1)) - 1);
                } else if (source === "Ir192") {
                    if (technique === "SWSI" && wanddikte >= 10 && wanddikte <= 40) wire = "W" + (parseInt(wire.substring(1)) - 1);
                    else if (technique === "DWDI" && doorstraaldeDikte > 10 && doorstraaldeDikte <= 25) wire = "W" + (parseInt(wire.substring(1)) - 1);
                    else if (technique === "DWSI" && doorstraaldeDikte > 10 && doorstraaldeDikte <= 40) wire = "W" + (parseInt(wire.substring(1)) - 1 );
                }
            } else if (procedure === "ASME") {
                const asmeTechnique = document.getElementById("asmeTechnique").value;
                const weldType = document.getElementById("weldType").value;
                let maxOverdikte = 0;
                if (weldType === "A" || weldType === "D") {
                    if (wanddikte <= 2.4) maxOverdikte = 0.8;
                    else if (wanddikte <= 4.8) maxOverdikte = 1.5;
                    else if (wanddikte <= 25) maxOverdikte = 2.5;
                    else maxOverdikte = 3;
                } else if (weldType === "B" || weldType === "C") {
                    if (wanddikte <= 2.4) maxOverdikte = 2.5;
                    else if (wanddikte <= 4.8) maxOverdikte = 3;
                    else if (wanddikte <= 13) maxOverdikte = 4;
                    else if (wanddikte <= 25) maxOverdikte = 5;
                    else maxOverdikte = 6;
                }
                const effectiveWanddikte = wanddikte + maxOverdikte;
                if (asmeTechnique === "Sourceside") {
                    if (effectiveWanddikte <= 6.4) wire = "EN W13,ASME 5";
                    else if (effectiveWanddikte <= 9.5) wire = "EN W12, ASME 6";
                    else if (effectiveWanddikte <= 12.7) wire = "EN W11, ASME 7";
                    else if (effectiveWanddikte <= 19) wire = "EN W10, ASME 8";
                    else if (effectiveWanddikte <= 25.4) wire = "EN W9, ASME 9";
                    else if (effectiveWanddikte <= 38.1) wire = "EN W8, ASME 10";
                    else if (effectiveWanddikte <= 50.8) wire = "EN W7, ASME 11";
                    else if (effectiveWanddikte <= 63.5) wire = "EN W6, ASME 12";
                    else wire = "EN W5, ASME 13";
                } else { // Film side
                    if (effectiveWanddikte <= 6.4) wire = "EN W14,ASME 4";
                    else if (effectiveWanddikte <= 9.5) wire = "EN W13, ASME 5";
                    else if (effectiveWanddikte <= 12.7) wire = "EN W12, ASME 6";
                    else if (effectiveWanddikte <= 19) wire = "EN W11, ASME 7";
                    else if (effectiveWanddikte <= 25.4) wire = "EN W10, ASME 8";
                    else if (effectiveWanddikte <= 38.1) wire = "EN W9, ASME 9";
                    else if (effectiveWanddikte <= 50.8) wire = "EN W8, ASME 10";
                    else if (effectiveWanddikte <= 63.5) wire = "EN W7, ASME 11";
                    else wire = "EN W6, ASME 12";
                }
            }
            document.getElementById("wire-result").innerHTML = "Vereist draadje: <strong>" + wire + "</strong>";

            let minFFDOutput = "Minimale FFD: <strong>" + (isNaN(minFFD) || minFFD === 0 ? "N/A" : minFFD.toFixed(2) + " mm") + "</strong>";
            if (!isNaN(sfd)) {
                minFFDOutput += ` , Gekozen FFD: <strong>${sfd}mm</strong>`;
            }

            if (centraal && !isNaN(minFFD) && minFFD > 0) {
                let maxFFDAllowed = diameter / 2;
                minFFDOutput += (minFFD < maxFFDAllowed) ? 
                    `<br>✅ Centrale opstelling is toegestaan (Min. FFD < <strong>${maxFFDAllowed.toFixed(2)} mm</strong>)` :
                    `<br>❌ Centrale opstelling is <strong>niet</strong> toegestaan (Min. FFD ≥ <strong>${maxFFDAllowed.toFixed(2)} mm</strong>)`;
            }

            if (excentrisch && !isNaN(minFFD) && minFFD > 0) {
                let maxExcentrischFFDAllowed = diameter - (ofa + 10);
                 minFFDOutput += (minFFD < maxExcentrischFFDAllowed) ?
                    `<br>✅ Excentrische opstelling is toegestaan (Min. FFD < <strong>${maxExcentrischFFDAllowed.toFixed(2)} mm</strong>)` :
                    `<br>❌ Excentrische opstelling is <strong>niet</strong> toegestaan (Min. FFD ≥ <strong>${maxExcentrischFFDAllowed.toFixed(2)} mm</strong>)`;
            }
            document.getElementById("min-ffd-result").innerHTML = minFFDOutput;

            const maxKvResultElement = document.getElementById("max-kv-result");
            let maxKv = 0; 
            if (source === 'X-ray' && !isNaN(wanddikte)) {
                let doorstraaldeDikteKv = (technique === 'SWSI') ? wanddikte : 2 * wanddikte;
                maxKv = 100 + (8 * doorstraaldeDikteKv);

                if (maxKv > 0) {
                    const maxKvUitzondering = maxKv + 50;
                    maxKvResultElement.innerHTML = `Maximale Kv waarde: <strong>${maxKv.toFixed(0)}</strong> (<strong>${maxKvUitzondering.toFixed(0)}</strong> bij uitzondering)`;
                    maxKvResultElement.style.display = 'block';
                } else {
                    maxKvResultElement.style.display = 'none';
                }
            } else {
                maxKvResultElement.style.display = 'none';
            }

            let filmQualityProcedure = "";
            let doorstraaldeDikte = (technique === "SWSI") ? wanddikte : 2 * wanddikte;
            let filmQualitySource = source;

            if (procedure === "EN-A") filmQualityProcedure = "RT21013";
            else if (procedure === "EN-B") filmQualityProcedure = document.getElementById("enBSubProcedure").value || "RT21013";
            else if (procedure === "ASME") filmQualityProcedure = "RT21002";

            if (filmQualitySource === "X-ray") {
                filmQualitySource = (maxKv > 0 && maxKv < 150) ? "X-Ray <150kv" : "X-Ray >150Kv";
            }

            let ovenMateriaal = (filmQualityProcedure === "RT16172") ? document.getElementById("ovenMateriaal").value : "Nee";
            let filmType = determineFilmQuality(filmQualityProcedure, doorstraaldeDikte, filmQualitySource, ovenMateriaal);
            document.getElementById("film-quality-result").innerHTML = "Vereist filmtype: <strong>" + filmType + "</strong>";

            const activityResultElement = document.getElementById("activity-result");
            const brongrootteValue = document.getElementById("brongrootte").value;
            const selectedBron = bronnenData.find(b => b.label === brongrootteValue);

            if (selectedBron && (selectedBron.type === 'Se75' || selectedBron.type === 'Ir192')) {
                const today = new Date();
                const currentActivity = calculateActivityForCSV(selectedBron.initialActivity, selectedBron.type, selectedBron.date, today);
                activityResultElement.innerHTML = `Bron ${selectedBron.name} is op dit moment: <strong>${currentActivity.toFixed(2)} Ci</strong>.`;
                activityResultElement.style.display = 'block';
                maxKvResultElement.style.display = 'none';
            } else {
                activityResultElement.style.display = 'none';
            }

            // --- 3. Plot Exposures ---
            document.getElementById('container1A').style.display = 'none';
            document.getElementById('container2A').style.display = 'none';
            document.getElementById('container1B').style.display = 'none';
            document.getElementById('container2B').style.display = 'none';
            document.getElementById('diameterAntwoord').style.display = 'none';
            document.getElementById('verzet-result').style.display = 'none';
            const exposureResultEl = document.getElementById('exposure-result');
            exposureResultEl.style.display = 'none';

            if (!centraal) {
                if (technique === "DWDI") {
                    if (ovaaltje === "Ja") {
                        document.getElementById('diameterAntwoord').innerHTML = '<strong style="font-size: 1.3em; color: yellow; padding: 15px;">Aantal opnames: 2 Opnames onder 90 graden</strong>';
                        if (!isNaN(diameter) && !isNaN(wanddikte) && !isNaN(lasbreedte) && !isNaN(sfd)) {
                            const verzetResultElement = document.getElementById('verzet-result');
                            if (diameter > 100 || wanddikte > 8 || lasbreedte > (diameter / 4)) {
                                verzetResultElement.innerHTML = '<strong class="red-text">Opstelling 11 / F is niet toegestaan omdat niet aan de eisen wordt voldaan.</strong>';
                                verzetResultElement.style.display = 'block';
                            } else {
                                const A = sfd - diameter;
                                const verzet = 1.5 * lasbreedte * (A / diameter);
                                verzetResultElement.innerHTML = `Het benodigde verzet is: <strong>${verzet.toFixed(2)} mm</strong>`;
                                verzetResultElement.classList.remove('red-text');
                                verzetResultElement.style.display = 'block';
                            }
                        }
                    } else {
                        document.getElementById('diameterAntwoord').innerHTML = '<strong style="font-size: 1.3em; color: yellow; padding: 15px;">Aantal opnames: 3 Opnames onder 60 / 120 graden</strong>';
                    }
                    document.getElementById('diameterAntwoord').style.display = 'block';
                    return;
                }

                const klasse = (procedure === 'EN-A' || procedure === 'ASME') ? 'A' : 'B';
                const t_plot = ofa;
                const De_plot = diameter;
                const SFD = sfd;

                if (isNaN(t_plot) || isNaN(De_plot) || isNaN(SFD) || De_plot === 0 || SFD === 0 || (SFD - t_plot) === 0) {
                    return;
                }

                const x_value1 = t_plot / De_plot;
                const y_value1 = De_plot / SFD;
                const x_value2 = t_plot / De_plot;
                const y_value2 = De_plot / (SFD - t_plot);

                let exposureText = "";
                const showContainer1 = !(technique === "SWSI" && optie === "");
                const showContainer2 = (technique !== "DWSI" && !excentrisch);

                if (showContainer1) {
                    const exposures1 = getNumberOfExposures('graph1', x_value1, y_value1);
                    exposureText += `Het aantal opnames voor Opstelling 5/8/13/14 is: <strong>${exposures1}</strong>. `;
                }
                if (showContainer2) {
                    const exposures2 = getNumberOfExposures('graph2', x_value2, y_value2);
                    if (showContainer1) { exposureText += "<br>"; }
                    exposureText += `Het aantal opnames voor Opstelling 2 is: <strong>${exposures2}</strong>.`;
                }

                if (exposureText) {
                    exposureResultEl.innerHTML = exposureText;
                    exposureResultEl.style.display = 'block';
                }

                let x_pixel1, y_pixel1, x_pixel2, y_pixel2, y_scale1, y_scale2;

                if (klasse === 'B') {
                    x_pixel1 = (x_value1 / 0.25) * 488; y_pixel1 = (y_value1 / 2) * 819; y_scale1 = 819;
                    x_pixel2 = (x_value2 / 0.25) * 488; y_pixel2 = (y_value2 / 4) * 823; y_scale2 = 823;
                    if (showContainer1) document.getElementById('container1B').style.display = 'block';
                    if (showContainer2) document.getElementById('container2B').style.display = 'block';
                } else { 
                    x_pixel1 = (x_value1 / 0.25) * 487; y_pixel1 = (y_value1 / 2) * 823; y_scale1 = 823;
                    x_pixel2 = (x_value2 / 0.25) * 470; y_pixel2 = (y_value2 / 4) * 796; y_scale2 = 796;
                    if (showContainer1) document.getElementById('container1A').style.display = 'block';
                    if (showContainer2) document.getElementById('container2A').style.display = 'block';
                }

                const container1 = document.getElementById(`container1${klasse}`);
                const container2 = document.getElementById(`container2${klasse}`);

                if (showContainer1) {
                    container1.innerHTML = `<h2>Opstelling 5/8/13/14 (Klasse ${klasse})</h2>`;
                    container1.appendChild(createCrosshair(x_pixel1, y_scale1 - y_pixel1));
                }

                if (showContainer2) {
                    container2.innerHTML = `<h2>Opstelling 2 (Klasse ${klasse})</h2>`;
                    container2.appendChild(createCrosshair(x_pixel2, y_scale2 - y_pixel2));
                }
            }
        }
        
        function determineFilmQuality(procedure, w, source, ovenMateriaal = "Nee") {
            if (procedure === "RT20230059") {
                if (source !== "Se75") return "Alleen Se75 is toegestaan";
                if (w > 0 && w <= 14) return "D4 (Zwarting 2.6)";
                else if (w > 14) return "D5";
                else return "Ongeldige dikte (w moet > 0 zijn)";
            }

            if (procedure === "RT21002") return "D7";

            var quality = "/";
            var tables = {
                "RT21013": {
                    "0-6mm": { "X-Ray <150kv": "D4", "X-Ray >150Kv": "/", "Se75": "D5 (D4 recommended) *Als het draadje niet gehaald wordt dan D4 + minimaal zwarting 3.0", "Ir192": "/" },
                    "6-10mm": { "X-Ray <150kv": "D4", "X-Ray >150Kv": "D5", "Se75": "D5 (D4 recommended) *Als het draadje niet gehaald wordt dan D4 + minimaal zwarting 3.0", "Ir192": "/" },
                    "10-20mm": { "X-Ray <150kv": "/", "X-Ray >150Kv": "D5", "Se75": "D5", "Ir192": "D5" },
                    "20-50mm": { "X-Ray <150kv": "/", "X-Ray >150Kv": "D5", "Se75": "D5", "Ir192": "D5" },
                    ">50mm": { "X-Ray <150kv": "/", "X-Ray >150Kv": "D7", "Se75": "/", "Ir192": "D5" }
                },
                "RT16172": {
                    "0-6mm": { "X-Ray <150kv": "D4", "X-Ray >150Kv": "/", "Se75": "D4 (Zwarting 2.6)", "Ir192": "/" },
                    "6-10mm": { "X-Ray <150kv": "D4", "X-Ray >150Kv": "D4", "Se75": "D4 (Zwarting 2.6)", "Ir192": "/" },
                    "10-14mm": { "X-Ray <150kv": "D4", "X-Ray >150Kv": "D5", "Se75": "D4 (Zwarting 2.6)", "Ir192": "D4 (Zwarting 2.6)" },
                    "14-20mm": { "X-Ray <150kv": "/", "X-Ray >150Kv": "D5", "Se75": "D5", "Ir192": "D4 (Zwarting 2.6)" },
                    "20-50mm": { "X-Ray <150kv": "/", "X-Ray >150Kv": "D5", "Se75": "D5", "Ir192": "D5" },
                    ">50mm": { "X-Ray <150kv": "/", "X-Ray >150Kv": "D5", "Se75": "/", "Ir192": "D5" }
                },
                "RT14171": {
                    "0-6mm": { "X-Ray <150kv": "D4", "X-Ray >150Kv": "/", "Se75": "D4 (Zwarting 2.6)", "Ir192": "/" },
                    "6-10mm": { "X-Ray <150kv": "D4", "X-Ray >150Kv": "D4", "Se75": "D4 (Zwarting 2.6)", "Ir192": "/" },
                    "10-14mm": { "X-Ray <150kv": "D4", "X-Ray >150Kv": "D5", "Se75": "D4 (Zwarting 2.6)", "Ir192": "D4 (Zwarting 2.6)" },
                    "14-20mm": { "X-Ray <150kv": "/", "X-Ray >150Kv": "D5", "Se75": "D5", "Ir192": "D4 (Zwarting 2.6)" },
                    "20-50mm": { "X-Ray <150kv": "/", "X-Ray >150Kv": "D5", "Se75": "D5", "Ir192": "D5" },
                    ">50mm": { "X-Ray <150kv": "/", "X-Ray >150Kv": "D5", "Se75": "/", "Ir192": "D5" }
                }
            };
            var selectedTable = tables[procedure];
            var dikteRange;
            if (w >= 0 && w <= 6) dikteRange = "0-6mm";
            else if (w > 6 && w <= 10) dikteRange = "6-10mm";
            else if ((procedure === "RT16172" || procedure === "RT14171") && w > 10 && w <= 14) dikteRange = "10-14mm";
            else if ((procedure === "RT16172" || procedure === "RT14171") && w > 14 && w <= 20) dikteRange = "14-20mm";
            else if (procedure === "RT21013" && w > 10 && w <= 20) dikteRange = "10-20mm";
            else if (w > 20 && w <= 50) dikteRange = "20-50mm";
            else if (w > 50) dikteRange = ">50mm";
            else return "Ongeldige dikte";
            if (selectedTable && dikteRange && selectedTable[dikteRange] && selectedTable[dikteRange][source]) {
                quality = selectedTable[dikteRange][source];
            }
            if (quality === "/") return "deze combinatie van bron en doorstraalde dikte is onlogisch";
            if (procedure === "RT16172" && ovenMateriaal === "Ja") return "D4";
            return quality;
        }

        // --- ONLOAD INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', function() {
            laadBronnenCSV();
            document.getElementById("optieDiv").style.display = "none";
            autoCalculate(true);
            
            const sfdInput = document.getElementById("sfd");
            if (!isNaN(minFFD) && minFFD > 0) {
                 sfdInput.value = minFFD.toFixed(2);
            } else {
                 sfdInput.value = "0";
            }
        });
    </script>
    <div style="height: 200px;"></div>
</body>
</html>
