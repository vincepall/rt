<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gecombineerde FFD en Opname Calculator</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <a href="index.html" class="home-icon"><i class="fas fa-home"></i></a>

    <style>
        /* --- Gecombineerde Stijlen --- */
        body {
            font-family: 'Roboto Condensed', sans-serif;
            padding: 20px;
            margin: 0;
        }

        /* Stijlen voor de info-knop (i) */
        .info-btn {
            background-color: #ddd;
            color: black;
            padding: 5px 12px;
            font-size: 16px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            margin: 5px;
            width: auto; 
            margin-top: 0;
        }

        /* Stijlen voor de hoofd-berekenknop */
        .submit-btn {
            background-color: #F5DF4D;
            color: black;
            padding: 15px 30px;
            font-size: 18px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            display: block; /* Maakt het mogelijk om margin auto te gebruiken */
            margin: 20px auto; /* Centeert de knop */
            width: 100%; /* Maakt knop responsief */
            max-width: 400px; /* Voorkomt dat knop te breed wordt */
        }

        .submit-btn:hover {
            background-color: #FFD700;
        }

        /* Stijlen voor de modals (pop-ups) */
        .modal {
            display: none; 
            position: fixed; 
            z-index: 1; 
            left: 0;
            top: 0;
            width: 100%; 
            height: 100%; 
            overflow: auto; 
            background-color: rgb(0,0,0); 
            background-color: rgba(0,0,0,0.4); 
        }
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto; 
            padding: 20px;
            border: 1px solid #888;
            width: 80%; 
            max-width: 600px;
        }
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        /* Stijlen voor het formulier (van deel 2) */
        .form-container {
            display: flex;
            flex-direction: column; /* Alles onder elkaar */
            gap: 15px;
            margin: 10px auto;
            max-width: 600px; /* Limiteert de breedte voor leesbaarheid */
        }

        .form-item {
            display: flex;
            flex-direction: row;
            align-items: center;
            flex-wrap: wrap; /* Zorgt dat label op mobiel boven input springt */
        }

        .form-item label {
            min-width: 200px; /* Zorgt voor nette uitlijning */
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-item input,
        .form-item select {
            flex: 1; /* Vult de beschikbare ruimte */
            padding: 8px;
            width: 100%;
            min-width: 200px; /* Zorgt dat input niet te smal wordt */
            box-sizing: border-box; /* Zorgt dat padding de breedte niet beïnvloedt */
        }

        /* Stijlen voor de plot-afbeeldingen */
        .image-container {
            position: relative;
            background-size: cover;
            border: 1px solid black;
            margin: 20px auto; /* Centeert de containers */
        }

        .image-container img {
            width: 100%;
            height: 100%;
        }

        .crosshair {
            position: absolute;
            width: 30px;
            height: 30px;
            left: 0;
            top: 0;
            pointer-events: none;
        }

        .crosshair::before,
        .crosshair::after {
            content: '';
            position: absolute;
            background-color: rgb(255, 49, 49);
        }

        .crosshair::before { top: 14px; left: 0; width: 30px; height: 2px; }
        .crosshair::after { left: 14px; top: 0; width: 2px; height: 30px; }

        .highlight-circle {
            position: absolute;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: rgba(0, 0, 128, 0.2);
            left: -10px;
            top: -10px;
            pointer-events: none;
        }

        h1 {
             color: #F5DF4D; 
             text-align: center;
        }
        
        h2 {
            color: blue;
        }

        #container1A h2,
        #container2A h2,
        #container1B h2,
        #container2B h2 {
            color: red;
        }

        /* Stijlen voor de "Rondnaad tool" link */
        .link-list { list-style: none; padding: 0; display: flex; flex-wrap: wrap; justify-content: center; }
        .link-list li { margin: 5px; }
        .link-list a {
            text-decoration: none; color: #000000; padding: 10px 30px; border-radius: 15px;
            font-size: 0.9rem; font-weight: bold; transition: transform 0.3s;
            display: inline-flex; align-items: center; justify-content: center;
            background-size: contain; background-position: center; background-repeat: no-repeat;
            width: 200px; height: 50px; background-color: transparent; gap: 10px;
        }
        .link-list a:hover { transform: scale(1.05); background-color: transparent; }
        .link2 { background-image: url('tape2.PNG'); }
        
        /* Media query voor kleinere schermen */
        @media (max-width: 600px) {
            .form-item {
                flex-direction: column;
                align-items: flex-start;
            }
            .form-item label {
                min-width: 100%;
                margin-bottom: 5px;
            }
            .form-item input,
            .form-item select {
                width: 100%;
                min-width: 0;
            }
            .image-container {
                width: 100%;
                height: auto;
            }
            .image-container img {
                width: 100%;
                height: auto;
            }
        }
    </style>
</head>
<body>

    <h1>Gecombineerde FFD en Opname Calculator</h1>
    
    <div style="text-align: center;">
        <button class="info-btn" onclick="openModal('myModal1')">i (FFD)</button>
        <button class="info-btn" onclick="openModal('myModal2')">i (Opnames)</button>
    </div>

    <div id="myModal1" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('myModal1')">&times;</span>
            <p>
                De minimale bron film afstand wordt bij EN bepaald doormiddel van de formules waar het nomogram op gebaseerd is en bij ASME doormiddel van de formule voor geometrische onscherpte.
                Er wordt bij ASME automatisch de juiste formule gebruikt tot 100mm wanddikte. Bij EN kun je de optie excentrisch of centraal aanklikken waardoor er 20%(excentrisch) of 50%(centraal) van de FFD wordt afgetrokken.
                Bij ASME wordt géén factor toegepast maar wordt alleen gecontroleerd of dit is toegestaan op basis van diameter en OFA.
            </p>
        </div>
    </div>

    <div id="myModal2" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeModal('myModal2')">&times;</span>
        <p>Deze tool geeft je geen direct antwoord maar zal op basis van de ingevoerde gegevens een rode punt op de afbeelding zetten waardoor je zelf kunt zien hoeveel opnames het zouden moeten zijn.</p>
      </div>
    </div>

    <form id="combinedForm">
        <div class="form-container">
            
            <div class="form-item">
                <label for="brongrootte">Brongrootte:</label>
                <input type="number" id="brongrootte" name="brongrootte" step="0.01" required>
            </div>
    
            <div class="form-item">
                <label for="ofa">Object Film Afstand (OFA):</label>
                <input type="number" id="ofa" name="ofa" step="0.01" required>
            </div>
    
            <div class="form-item">
                <label for="standaard">Kies een standaard:</label>
                <select id="standaard" name="standaard" required>
                    <option value="" disabled selected>Kies een standaard</option>
                    <option value="1">EN-klasse A</option>
                    <option value="2">EN-klasse B</option>
                    <option value="3">ASME</option>
                </select>
            </div>
    
            <div id="wanddikteInput" class="form-item" style="display:none;">
                <label for="wanddikte">Wanddikte (t/wt) in mm:</label>
                <input type="number" id="wanddikte" name="wanddikte" step="0.01">
            </div>
    
            <div id="extraOpties" class="form-item" style="display:none;">
                <label for="optie">Centraal of Excentrisch:</label>
                <select id="optie" name="optie">
                    <option value="">Nee</option>
                    <option value="1">Centraal</option>
                    <option value="2">Excentrisch</option>
                </select>
            </div>
    
            <div id="diameterInput" class="form-item" style="display:none;">
                <label for="diameter">Diameter (De) in mm:</label>
                <input type="number" id="diameter" name="diameter" step="0.01">
            </div>
    
            <div class="form-item">
                <label for="sfd">Bron Film Afstand (SFD):</label>
                <input type="number" id="sfd" name="sfd" step="0.001" required>
                <span id="min_ffd_output" style="margin-left: 10px; font-weight: bold; flex-basis: 100%;"></span>
            </div>

        </div> <button type="button" class="submit-btn" onclick="berekenEnPlot()">Bekijk opnames</button>
    </form>
    
    <p id="output" style="color: #F5DF4D; text-align: center; font-weight: bold;"></p>

    <ul class="link-list">
        <li><a href="cw2.html" class="link2"><i class="fa-solid fa-circle-radiation"></i>Rondnaad tool<i class="fa-solid fa-circle-radiation"></i></a></li>
    </ul>

    <hr style="margin: 40px 0; border: 1px solid #F5DF4D;">

    <div class="image-container" id="container1B" style="display: none; width: 488px; height: 819px; background-image: url('klasseb2.png');">
      <h2>Opstelling 5/8/13/14 (Klasse B)</h2>
    </div>
    <div class="image-container" id="container2B" style="display: none; width: 488px; height: 823px; background-image: url('klasseb1.png');">
      <h2>Opstelling 2 (Klasse B)</h2>
    </div>
    <div class="image-container" id="container1A" style="display: none; width: 487px; height: 823px; background-image: url('opstelling13klassea.png');">
      <h2>Opstelling 5/8/13/14 (Klasse A)</h2>
    </div>
    <div class="image-container" id="container2A" style="display: none; width: 470px; height: 796px; background-image: url('opstelling2klassea.png');">
      <h2>Opstelling 2 (Klasse A)</h2>
    </div>


    <script>
        // --- Variabelen voor de dynamische velden ---
        const standaardSelect = document.getElementById("standaard");
        const extraOptiesDiv = document.getElementById("extraOpties");
        const wanddikteDiv = document.getElementById("wanddikteInput");
        const optieSelect = document.getElementById("optie");
        const diameterDiv = document.getElementById("diameterInput");

        // --- Event Listeners voor dynamische velden ---
        standaardSelect.addEventListener("change", function () {
            // Toon altijd de Centraal/Excentrisch optie
            if (standaardSelect.value === '1' || standaardSelect.value === '2' || standaardSelect.value === '3') {
                extraOptiesDiv.style.display = "flex"; // "flex" ipv "block" voor .form-item
            } else {
                extraOptiesDiv.style.display = "none";
            }

            // Toon wanddikte alleen voor ASME
            if (standaardSelect.value === '3') {
                wanddikteDiv.style.display = "flex";
            } else {
                wanddikteDiv.style.display = "none";
            }
            
            // Trigger check voor diameter, voor het geval optie al geselecteerd was
            toggleDiameterVisibility(); 
        });

        optieSelect.addEventListener("change", function () {
            toggleDiameterVisibility();
        });

        function toggleDiameterVisibility() {
            // Toon diameter als Centraal of Excentrisch is gekozen
            if (optieSelect.value === '1' || optieSelect.value === '2') {
                diameterDiv.style.display = "flex";
            } else {
                diameterDiv.style.display = "none";
            }
        }

        // --- Grote functie voor berekenen en plotten ---
        function berekenEnPlot() {
            // --- Deel 1: Alle waarden verzamelen ---
            let ofa = parseFloat(document.getElementById("ofa").value);
            let brongrootte = parseFloat(document.getElementById("brongrootte").value);
            let standaard = document.getElementById("standaard").value;
            let optie = document.getElementById("optie").value;
            let diameter = parseFloat(document.getElementById("diameter").value);
            let wt = parseFloat(document.getElementById("wanddikte").value);
            let sfd_invoer = parseFloat(document.getElementById("sfd").value); // De handmatig ingevoerde FFD
            
            let output = document.getElementById("output");
            let ffd_output_span = document.getElementById("min_ffd_output");
            output.innerHTML = ""; // Reset meldingen
            ffd_output_span.innerHTML = ""; // Reset meldingen

            let centraal = (optie === '1');
            let excentrisch = (optie === '2');
            let ffd_min; // De berekende minimale FFD

            // --- Deel 2: Bereken de MINIMALE FFD (logica van script 1) ---
            
            // Validatie van inputs
            if (standaard === "") {
                output.innerHTML = "Maak een keuze in het veld 'Kies een standaard'.";
                return;
            }
            if (isNaN(ofa) || isNaN(brongrootte)) {
                output.innerHTML = "Voer geldige OFA en Brongrootte in.";
                return;
            }
            if (centraal && (isNaN(diameter) || diameter <= 0)) {
                output.innerHTML = "Voer een geldige diameter in voor centrale opstelling.";
                return;
            }
            if (excentrisch && (isNaN(diameter) || diameter <= 0)) {
                output.innerHTML = "Voer een geldige diameter in voor excentrische opstelling.";
                return;
            }
            
            if (standaard === '3') {  // ASME
                if (isNaN(wt)) {
                    output.innerHTML = "Voer een geldige wanddikte in voor ASME.";
                    return;
                }
                if (wt < 50) { var boa = (brongrootte * ofa) / 0.51; }
                else if (wt < 75) { var boa = (brongrootte * ofa) / 0.76; }
                else if (wt <= 100) { var boa = (brongrootte * ofa) / 1.02; }
                else {
                    output.innerHTML = "Ongeldige wanddikte (ASME). Voer een waarde tussen 0 en 100 mm in.";
                    return;
                }
                ffd_min = boa + ofa;

            } else if (standaard === '2') {  // EN-klasse B
                let basis = brongrootte * 15 * Math.pow(ofa, 2 / 3);
                if (centraal) { basis *= 0.5; }
                else if (excentrisch) { basis *= 0.8; }
                ffd_min = basis + ofa;

            } else if (standaard === '1') {  // EN-klasse A
                let basis = brongrootte * 7.5 * Math.pow(ofa, 2 / 3);
                if (centraal) { basis *= 0.5; }
                else if (excentrisch) { basis *= 0.8; }
                ffd_min = basis + ofa;
            }

            // Toon de centraal/excentrisch checks
            if (centraal) {
                let maxFFD = diameter / 2;
                if (ffd_min < maxFFD) {
                    output.innerHTML += `✅ Centrale opstelling is toegestaan (Min FFD ${ffd_min.toFixed(2)} mm < ${maxFFD.toFixed(2)} mm)<br>`;
                } else {
                    output.innerHTML += `❌ Centrale opstelling is <strong>niet</strong> toegestaan (Min FFD ${ffd_min.toFixed(2)} mm ≥ ${maxFFD.toFixed(2)} mm)<br>`;
                }
            }
            if (excentrisch) {
                let maxExcentrischFFD = diameter - (ofa + 10);
                if (ffd_min < maxExcentrischFFD) {
                    output.innerHTML += `✅ Excentrische opstelling is toegestaan (Min FFD ${ffd_min.toFixed(2)} mm < ${maxExcentrischFFD.toFixed(2)} mm)<br>`;
                } else {
                    output.innerHTML += `❌ Excentrische opstelling is <strong>niet</strong> toegestaan (Min FFD ${ffd_min.toFixed(2)} mm ≥ ${maxExcentrischFFD.toFixed(2)} mm)<br>`;
                }
            }

            // --- Deel 3: Toon FFD Advies ---
            if (isNaN(sfd_invoer)) {
                output.innerHTML = "Voer een geldige Bron Film Afstand (SFD) in om te plotten.";
                return;
            }
            
            ffd_output_span.innerHTML = `(Minimaal vereiste FFD: ${ffd_min.toFixed(2)} mm)`;
            
            if (sfd_invoer < ffd_min) {
                ffd_output_span.style.color = "red";
                ffd_output_span.innerHTML += " - Uw invoer is te laag!";
            } else {
                ffd_output_span.style.color = "green";
                ffd_output_span.innerHTML += " - OK";
            }

            // --- Deel 4: Plot de opnames (logica van script 2) ---
            
            // Bepaal de klasse op basis van de standaard
            let klasse;
            if (standaard === '1' || standaard === '3') { // EN-A en ASME = Klasse A
                klasse = 'A';
            } else { // EN-B = Klasse B
                klasse = 'B';
            }

            // Haal de waarden opnieuw op voor de plot (wanddikte kan anders zijn dan bij ASME)
            const t = parseFloat(document.getElementById("wanddikte").value); // Wanddikte voor plot
            const De = parseFloat(document.getElementById("diameter").value); // Diameter voor plot
            const SFD = sfd_invoer; // Gebruik de ingevoerde SFD voor de plot

            if (isNaN(t) || isNaN(De)) {
                 output.innerHTML += "<br>Voer een geldige Wanddikte en Diameter in om te plotten.";
                 return;
            }

            const x_value1 = t / De;
            const y_value1 = De / SFD;
            const x_value2 = t / De;
            const y_value2 = De / (SFD - t);

            let x_pixel1, y_pixel1, x_pixel2, y_pixel2, y_scale1, y_scale2;

            // Verberg alle containers
            document.getElementById('container1A').style.display = 'none';
            document.getElementById('container2A').style.display = 'none';
            document.getElementById('container1B').style.display = 'none';
            document.getElementById('container2B').style.display = 'none';

            if (klasse === 'B') {
                x_pixel1 = (x_value1 / 0.25) * 488;
                y_pixel1 = (y_value1 / 2) * 819;
                y_scale1 = 819;
                x_pixel2 = (x_value2 / 0.25) * 488;
                y_pixel2 = (y_value2 / 4) * 823;
                y_scale2 = 823;
                document.getElementById('container1B').style.display = 'block';
                document.getElementById('container2B').style.display = 'block';
            } else if (klasse === 'A') {
                x_pixel1 = (x_value1 / 0.25) * 487;
                y_pixel1 = (y_value1 / 2) * 823;
                y_scale1 = 823;
                x_pixel2 = (x_value2 / 0.25) * 470;
                y_pixel2 = (y_value2 / 4) * 796;
                y_scale2 = 796;
                document.getElementById('container1A').style.display = 'block';
                document.getElementById('container2A').style.display = 'block';
            }

            const container1 = document.getElementById(`container1${klasse}`);
            const container2 = document.getElementById(`container2${klasse}`);

            container1.innerHTML = `<h2 style="color: red;">Opstelling 5/8/13/14 (Klasse ${klasse})</h2>`;
            container1.appendChild(createCrosshair(x_pixel1, y_scale1 - y_pixel1));
            container2.innerHTML = `<h2 style="color: red;">Opstelling 2 (Klasse ${klasse})</h2>`;
            container2.appendChild(createCrosshair(x_pixel2, y_scale2 - y_pixel2));

            // Scroll naar de eerste afbeelding
            container1.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        // --- Hulpfuncties ---
        
        function createCrosshair(x, y) {
            const cross = document.createElement('div');
            cross.className = 'crosshair';
            cross.style.left = (x - 15) + 'px';
            cross.style.top = (y - 15) + 'px';
            const circle = document.createElement('div');
            circle.className = 'highlight-circle';
            cross.appendChild(circle);
            return cross;
        }

        function openModal(id) {
            document.getElementById(id).style.display = "block";
        }

        function closeModal(id) {
            document.getElementById(id).style.display = "none";
        }

    </script>
</body>
</html>
