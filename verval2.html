<!DOCTYPE html>
<html lang="nl">
<head>
    <link rel="stylesheet" href="styles.css">
    <a href="index.html" class="home-icon"><i class="fas fa-home"></i></a>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Activiteitsberekening</title>
    <script>
        // Functie om CSV-bestand in te laden en weer te geven als tabel met extra kolom
        function loadCSV(file) {
            fetch(file)
                .then(response => response.text())
                .then(data => {
                    const rows = data.split("\n");
                    let table = '<table border="1"><tr>';

                    rows.forEach((row, index) => {
                        const cols = row.split(",");
                        if (index === 0) {
                            table += '<tr>';
                            cols.forEach(col => {
                                table += `<th>${col}</th>`;
                            });
                            table += '<th>Activiteit op huidige datum</th>'; // Nieuwe kolom toegevoegd
                            table += '</tr>';
                        } else {
                            const bron = cols[0];
                            const type = cols[1];
                            const activiteit = cols[2];
                            const datum = cols[3];

                            // Bereken de activiteit op de huidige datum
                            const currentDate = new Date();
                            const firstDate = new Date(datum.split('-').reverse().join('-'));
                            const timeDifference = currentDate - firstDate;
                            const days = timeDifference / (1000 * 3600 * 24);
                            let ci2 = 0;

                            if (type === "Se75") {
                                ci2 = activiteit / Math.pow(2, days / 120);
                            } else if (type === "Ir192") {
                                ci2 = activiteit / Math.pow(2, days / 74);
                            }

                            table += `<tr onclick="fillFormAndCalculate('${bron}', '${type}', '${activiteit}', '${datum}')">`;
                            cols.forEach(col => {
                                table += `<td>${col}</td>`;
                            });
                            // Nieuwe cel met de berekende activiteit in kleur
                            table += `<td style="color: #F5DF4D;">${ci2.toFixed(2)} Ci</td>`;
                            table += '</tr>';
                        }
                    });
                    table += '</table>';

                    // Plaats de tabel in de div met id="csvTable"
                    document.getElementById("csvTable").innerHTML = table;

                    // Vul de eerste rij automatisch in en bereken de activiteit
                    const firstRow = rows[1].split(",");
                    fillFormAndCalculate(firstRow[0], firstRow[1], firstRow[2], firstRow[3]);
                })
                .catch(error => console.error("Error loading CSV:", error));
        }

        // Functie om de formuliervelden in te vullen en meteen de berekening uit te voeren
        function fillFormAndCalculate(bron, type, activiteit, datum) {
            document.getElementById("isotope").value = type;
            document.getElementById("ci1").value = activiteit;
            document.getElementById("firstDate").value = datum.split('-').reverse().join('-');
            document.getElementById("secondDate").value = "";

            const secondDate = new Date();
            const firstDate = new Date(datum.split('-').reverse().join('-'));
            const timeDifference = secondDate - firstDate;
            const days = timeDifference / (1000 * 3600 * 24);

            let ci2 = 0;

            if (type === "Se75") {
                ci2 = activiteit / Math.pow(2, days / 120);
            } else if (type === "Ir192") {
                ci2 = activiteit / Math.pow(2, days / 74);
            }

            document.getElementById("result").innerHTML = `Bron <span style="color:#F5DF4D">${bron}</span> heeft nog <span style="color:#F5DF4D">${ci2.toFixed(2)} Ci</span> op <span style="color:#F5DF4D">${secondDate.toLocaleDateString('nl-NL')}</span>.`;
        }

        window.onload = function() {
            loadCSV('bronnen.csv');
        };
    </script>
</head>
<body>
    <h1 style="color: #F5DF4D; text-align: center;">Activiteit</h1>

    <!-- De knop om het pop-up venster te openen -->
    <button class="info-btn" onclick="openModal('myModal')">i</button>

    <!-- Het pop-up venster -->
    <div id="myModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('myModal')">&times;</span>
            <p>Door op een bron te duwen krijg je de activiteit op dit moment. De waardes in de tabel zijn uit de vervoersdocumenten gehaald.
            </p>
        </div>
    </div>

    <script src="script.js"></script> <!-- Link naar externe JavaScript -->

    <h2>Bronnen Tabel (klik op de bron)</h2>
    <!-- Hier wordt de CSV-tabel weergegeven -->
    <div id="csvTable">De tabel wordt geladen...</div>

    <label for="isotope">Kies een isotoop:</label>
    <select id="isotope">
        <option value="Se75">Se75</option>
        <option value="Ir192">Ir192</option>
    </select><br><br>

    <label for="ci1">Ci op eerste datum (Ci1):</label>
    <input type="number" id="ci1" required><br><br>

    <label for="firstDate">Eerste datum:</label>
    <input type="date" id="firstDate" required><br><br>

    <label for="secondDate">Tweede datum (standaard is de huidige datum):</label>
    <input type="date" id="secondDate"><br><br>

    <button onclick="calculateActivity()">Bereken activiteit</button>

    <h2 id="result"></h2>

</body>
</html>
