<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Activiteitsberekening</title>
    <script>
        // Bereken de activiteit direct na het invullen van het formulier
        function calculateActivity(isotope, ci1, firstDate, bron) {
            const secondDate = new Date();  // Gebruik de huidige datum als de tweede datum
            const firstDateObj = new Date(firstDate);

            // Bereken het aantal dagen tussen de twee datums
            const timeDifference = secondDate - firstDateObj;
            const days = timeDifference / (1000 * 3600 * 24);

            let ci2 = 0;

            // Controleer welk isotoop is gekozen en voer de juiste berekening uit
            if (isotope === "Se75") {
                ci2 = ci1 / Math.pow(2, days / 120);
            } else if (isotope === "Ir192") {
                ci2 = ci1 / Math.pow(2, days / 74);
            }

            // Toon het resultaat met de naam van de bron
            document.getElementById("result").innerHTML = `De activiteit van bron ${bron} is nog ${ci2.toFixed(2)} Curie.`;
        }

        // Functie om CSV-bestand in te laden en weer te geven als tabel met aanklikbare rijen
        function loadCSV(file) {
            fetch(file)
                .then(response => response.text())
                .then(data => {
                    const rows = data.split("\n");
                    let table = '<table border="1"><tr>';
                    
                    // Verwerk de CSV-rijen en genereer de HTML-tabel
                    rows.forEach((row, index) => {
                        const cols = row.split(",");
                        if (index === 0) {
                            table += '<tr>';
                            cols.forEach(col => {
                                table += `<th>${col}</th>`;  // Voeg koptekst toe
                            });
                            table += '</tr>';
                        } else {
                            const bron = cols[0];
                            const type = cols[1];
                            const activiteit = cols[2];
                            const datum = cols[3];

                            table += `<tr onclick="fillFormAndCalculate('${bron}', '${type}', '${activiteit}', '${datum}')">`;
                            cols.forEach(col => {
                                table += `<td>${col}</td>`;  // Voeg gegevens toe
                            });
                            table += '</tr>';
                        }
                    });
                    table += '</table>';
                    
                    // Plaats de tabel onderaan de pagina in de div met id="csvTable"
                    document.getElementById("csvTable").innerHTML = table;
                })
                .catch(error => console.error("Error loading CSV:", error));
        }

        // Functie om de formuliervelden in te vullen en direct de berekening uit te voeren
        function fillFormAndCalculate(bron, type, activiteit, datum) {
            document.getElementById("isotope").value = type; // Zet het type isotoop
            document.getElementById("ci1").value = activiteit; // Vul de activiteit (Ci1) in
            document.getElementById("firstDate").value = datum.split('-').reverse().join('-'); // Formatteer de datum correct voor de input

            // Roep direct de berekening aan met de juiste parameters
            calculateActivity(type, parseFloat(activiteit), datum.split('-').reverse().join('-'), bron);
        }

        // Laad de tabel als de pagina geladen is
        window.onload = function() {
            loadCSV('bronnen.csv');  // Laadt gegevens uit bronnen.csv
        };
    </script>
</head>
<body>
    <h1>Activiteitsberekening</h1>
    
    <label for="isotope">Kies een isotoop:</label>
    <select id="isotope" disabled>
        <option value="Se75">Se75</option>
        <option value="Ir192">Ir192</option>
    </select><br><br>

    <label for="ci1">Ci op eerste datum (Ci1):</label>
    <input type="number" id="ci1" required disabled><br><br>

    <label for="firstDate">Eerste datum:</label>
    <input type="date" id="firstDate" required disabled><br><br>

    <h2 id="result"></h2>

    <h2>Bronnen Tabel</h2>
    <!-- Hier wordt de CSV-tabel weergegeven -->
    <div id="csvTable">De tabel wordt geladen...</div>

</body>
</html>
